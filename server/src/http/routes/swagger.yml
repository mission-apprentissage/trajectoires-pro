openapi: 3.0.1
info:
  title: API Exposition InserJeunes
  description: |
    L’API Exposition InserJeunes permet **la récupération des [données InserJeunes](https://documentation.exposition.inserjeunes.beta.gouv.fr/)** (dont la “part en emploi à 6 mois” et le “taux en formation”).

    Les diverses routes permettent de récupérer ces données : 

    - pour une **formation / certification,** à partir d’un code MEFSTAT11, pour la voie scolaire ou d’un code formation diplôme (CFD), pour la voie apprentissage.
    - pour une **formation / certification au sein d’un établissement,** à partir d’un code UAI (Unité Administrative Immatriculée) et d’un code MEFSTAT11 (voie scolaire), CFD (code formation diplôme, pour la voie apprentissage) ou d’un code SISE (système d'information statistique des étudiants, pour le supérieur).

    L’API permet en outre de récupérer plusieurs de ces éléments à la fois, et propose divers filtres, par exemple pour récupérer les données à la maille régionale ou académique.

    Certaines routes, mentionnées par un cadenas, nécessitent une authentification. Pour obtenir une clef API, nous vous invitons à [contacter nos équipes](mailto:contact@inserjeunes.beta.gouv.fr).

    Le code source de l’API est public et disponible [sur Github](https://github.com/mission-apprentissage/trajectoires-pro/).

  license:
    name: MIT License
    url: https://raw.githubusercontent.com/mission-apprentissage/trajectoires-pro/main/LICENSE
  version: 1.0.0

paths:
  /api/inserjeunes/auth/login:
    post:
      description: |
        Permet de s'authentifier afin de récupérer un JSON Web Token qui permet l'accès aux routes demandant une autorisation.
        
        Le token expire après 1 jour.
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Login'
          application/json:
            schema:
              $ref: '#/components/schemas/Login'
      responses:
        200:
          $ref: "#/components/responses/LoginResponse"
        401:
          $ref: "#/components/responses/401"
  /api/inserjeunes/certifications:
    get:
      description: Rechercher des statistiques de certifications
      parameters:
        - $ref: "#/components/parameters/millesimes"
        - $ref: "#/components/parameters/code_certifications_with_sise"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
      responses:
        200:
          $ref: "#/components/responses/CertificationsResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/certifications.{ext}:
    get:
      description: Exporter des statistiques de certifications
      parameters:
        - $ref: "#/components/parameters/millesimes"
        - $ref: "#/components/parameters/code_certifications_with_sise"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
        - $ref: "#/components/parameters/ext"
      responses:
        200:
          $ref: "#/components/responses/CertificationsResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/certifications/{code_certification}:
    get:
      description: Obtenir les statistiques d'une certification
      parameters:
        - $ref: "#/components/parameters/code_certification_with_sise"
        - $ref: "#/components/parameters/millesime"
        - $ref: "#/components/parameters/vue"
      responses:
        200:
          $ref: "#/components/responses/CertificationResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404-Code-Certification"

  /api/inserjeunes/certifications/{codes_certifications}:
    get:
      description: Obtenir les statistiques agrégées de plusieurs certifications sous la forme d'une vue par filière (pro et apprentissage)
      parameters:
        - $ref: "#/components/parameters/multiple_codes_certifications"
        - $ref: "#/components/parameters/millesime"
      responses:
        200:
          $ref: "#/components/responses/FilieresResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404-Code-Certification"

  /api/inserjeunes/regionales:
    get:
      description: Rechercher des statistiques régionales
      parameters:
        - $ref: "#/components/parameters/regions"
        - $ref: "#/components/parameters/millesimesRegional"
        - $ref: "#/components/parameters/code_certifications"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
      responses:
        200:
          $ref: "#/components/responses/RegionalesResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/regionales.{ext}:
    get:
      description: Exporter des statistiques régionales
      parameters:
        - $ref: "#/components/parameters/regions"
        - $ref: "#/components/parameters/millesimesRegional"
        - $ref: "#/components/parameters/code_certifications"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
        - $ref: "#/components/parameters/ext"
      responses:
        200:
          $ref: "#/components/responses/RegionalesResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/regionales/{code_region}:
    get:
      description: Rechercher des statistiques d'une région
      parameters:
        - $ref: "#/components/parameters/code_region"
        - $ref: "#/components/parameters/millesimesRegional"
        - $ref: "#/components/parameters/code_certifications"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
      responses:
        200:
          $ref: "#/components/responses/RegionalesResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/regionales/{code_region}.{ext}:
    get:
      description: Exporter des statistiques d'une région
      parameters:
        - $ref: "#/components/parameters/code_region"
        - $ref: "#/components/parameters/millesimesRegional"
        - $ref: "#/components/parameters/code_certifications"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
        - $ref: "#/components/parameters/ext"
      responses:
        200:
          $ref: "#/components/responses/RegionalesResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/regionales/{code_region}/certifications/{code_certification}:
    get:
      description: Obtenir les statistiques d'une certification
      parameters:
        - $ref: "#/components/parameters/code_region"
        - $ref: "#/components/parameters/code_certification"
        - $ref: "#/components/parameters/millesimePeriode"
        - $ref: "#/components/parameters/vue"
      responses:
        200:
          $ref: "#/components/responses/RegionaleResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404-Code-Regionale"

  /api/inserjeunes/regionales/{code_region}/certifications/{codes_certifications}:
    get:
      description: Obtenir les statistiques agrégées de plusieurs certifications sous la forme d'une vue par filière (pro et apprentissage)
      parameters:
        - $ref: "#/components/parameters/code_region"
        - $ref: "#/components/parameters/multiple_codes_certifications"
        - $ref: "#/components/parameters/millesimePeriode"
      responses:
        200:
          $ref: "#/components/responses/FilieresRegionaleResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404-Code-Regionale"

  /api/inserjeunes/formations:
    get:
      description: Rechercher des statistiques de formations
      parameters:
        - $ref: "#/components/parameters/uais"
        - $ref: "#/components/parameters/regions"
        - $ref: "#/components/parameters/academies"
        - $ref: "#/components/parameters/millesimesFormation"
        - $ref: "#/components/parameters/code_certifications_with_sise"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
      responses:
        200:
          $ref: "#/components/responses/FormationsResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/formations.{ext}:
    get:
      description: Exporter des statistiques de formations
      parameters:
        - $ref: "#/components/parameters/ext"
        - $ref: "#/components/parameters/uais"
        - $ref: "#/components/parameters/regions"
        - $ref: "#/components/parameters/academies"
        - $ref: "#/components/parameters/millesimesFormation"
        - $ref: "#/components/parameters/code_certifications_with_sise"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/items_par_page"
      responses:
        200:
          $ref: "#/components/responses/FormationsResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404"

  /api/inserjeunes/formations/{uai}-{code_certification}:
    get:
      description: Obtenir des statistiques d'une formation
      parameters:
        - $ref: "#/components/parameters/uai_with_sise"
        - $ref: "#/components/parameters/code_certification_with_sise"
        - $ref: "#/components/parameters/millesimeFormationPeriode"
      responses:
        200:
          $ref: "#/components/responses/FormationResponse"
        400:
          $ref: "#/components/responses/400"
        401:
          $ref: "#/components/responses/401"
        404:
          $ref: "#/components/responses/404-Code-Formation"

components:
  parameters:
    # Query parameters
    millesimes:
      name: millesimes
      in: query
      description: |
        Permet de filtrer la recherche avec un ou plusieurs millesimes séparés par des virgules.

        * Les millesimes des certifications sont des années (ex: 2020)
        * Retourne les données du dernier millésime si le champ est vide
      schema:
        type: string

    millesimesRegional:
      name: millesimes
      in: query
      description: |
        Permet de filtrer la recherche avec un ou plusieurs millesimes séparés par des virgules.
        * Les millesimes au niveau régional sont des périodes (ex: 2020_2021)
        * Retourne les données du dernier millésime si le champ est vide
      schema:
        type: string

    millesimesFormation:
      name: millesimes
      in: query
      description: |
        Permet de filtrer la recherche avec un ou plusieurs millesimes séparés par des virgules.
        * Les millesimes au niveau établissement sont des périodes (ex: 2020_2021)
        * Retourne les données du dernier millésime si le champ est vide
      schema:
        type: string

    code_certifications:
      name: code_certifications
      in: query
      description: |
        Permet de filtrer la recherche avec un ou plusieurs codes de certification séparés par des virgules ou des |.

        Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
      schema:
        type: string

    code_certifications_with_sise:
      name: code_certifications
      in: query
      description: |
        Permet de filtrer la recherche avec un ou plusieurs codes de certification séparés par des virgules ou des |.

        Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
          * un code SISE pour le supérieur, précédé de "SISE:"<br />
          Exemple: "SISE:1234567"
      schema:
        type: string

    uais:
      name: uais
      in: query
      description: Permet de filtrer la recherche avec une ou plusieurs UAI séparées par des virgules.
      schema:
        type: string
        pattern: "^([0-9]{7}[A-Z]{1},)*[0-9]{7}[A-Z]{1}$"

    regions:
      name: regions
      in: query
      schema:
        type: string
      description: |
        Permet de filtrer la recherche avec un ou plusieurs codes de région séparés par des virgules.
        
        Valeurs possibles :
         ```
         84 Auvergne-Rhône-Alpes
         27 Bourgogne-Franche-Comté
         53 Bretagne
         24 Centre-Val de Loire
         00 Collectivités d'outre-mer
         94 Corse
         44 Grand Est
         01 Guadeloupe
         03 Guyane
         32 Hauts-de-France
         04 La Réunion
         02 Martinique
         06 Mayotte
         28 Normandie
         75 Nouvelle-Aquitaine
         76 Occitanie
         52 Pays de la Loire
         93 Provence-Alpes-Côte d'Azur
         11 Île-de-France
         ```
    
    academies:
      name: academies
      in: query
      schema:
        type: string
      description: |
        Permet de filtrer la recherche avec un ou plusieurs codes d'académie séparés par des virgules.
        
        Valeurs possibles :
        ```
        01 Paris                       02 Aix-Marseille
        03 Besançon                    04 Bordeaux
        06 Clermont-Ferrand            07 Dijon
        08 Grenoble                    09 Lille
        10 Lyon                        11 Montpellier
        12 Nancy-Metz                  13 Poitiers
        14 Rennes                      15 Strasbourg
        16 Toulouse                    17 Nantes
        18 Orléans-Tours               19 Reims
        20 Amiens                      22 Limoges
        23 Nice                        24 Créteil
        25 Versailles                  27 Corse
        28 La Réunion                  31 Martinique
        32 Guadeloupe                  33 Guyane
        40 Nouvelle-Calédonie          41 Polynésie Française
        42 Wallis et Futuna            43 Mayotte
        44 Saint-Pierre-et-Miquelon    70 Normandie
        77 Saint-Barthélemy            78 Saint-Martin
        ```
    
    page:
      name: page
      in: query
      description: Le numéro de la page désirée
      schema:
        type: integer

    items_par_page:
      name: items_par_page
      in: query
      description: Le nombre maximum d'éléments dans la page
      schema:
        type: integer
        default: 10

    millesime:
      name: millesime
      in: query
      description: |
        Les millesimes des certifications sont des années (ex: 2020).

        Retourne les données du dernier millésime si le champ est vide.
      required: false
      schema:
        type: string

    millesimePeriode:
      name: millesime
      in: query
      description: |
        Les millesimes au niveau régional sont des périodes (ex: 2020_2021).

        Retourne les données du dernier millésime si le champ est vide.
      required: false
      schema:
        type: string

    millesimeFormationPeriode:
      name: millesime
      in: query
      description: |
        Les millesimes au niveau établissement sont des périodes (ex: 2020_2021).

        Retourne les données du dernier millésime si le champ est vide.
      required: false
      schema:
        type: string

    vue:
      name: vue
      in: query
      description: |
        Retourne les statistiques représentées sous la forme d'une vue (voir réponse de [/api/inserjeunes/certifications/{codes_certifications}](#/default/get_api_inserjeunes_certifications__codes_certifications_))
        
        Vues :
         ```
         filieres
         ```
      required: false
      schema:
        type: string

    direction:
      name: direction
      in: query
      required: false
      schema:
        type: string
        enum: [ "vertical", "horizontal" ]
        default: "vertical"

    theme:
      name: theme
      in: query
      required: false
      schema:
        type: string
        enum: [ "dsfr", "lba" ]
        default: "dsfr"

    imageOnError:
      name: imageOnError
      description: |
        Retourne une image en cas d'erreur 404
        * true : retourne une image
        * false : retourne le message d'erreur
        * empty : retourne une image de type pixel vide
      in: query
      required: false
      schema:
        type: string
        enum: [ "true", "false", "empty"]

    # Path parameters
    uai:
      name: uai
      in: path
      required: true
      schema:
        type: string
        pattern: "^[0-9]{7}[A-Z]{1}$"
        example: "0060033D"

    uai_with_sise:
      name: uai
      in: path
      required: true
      schema:
        type: string
        pattern: "^[0-9]{7}[A-Z]{1}$"
        example: "0060033D"
      examples:
        scolaire/apprentissage:
          value: "0060033D"
        superieur:
          value: "0062205P"

    code_region:
      name: code_region
      in: path
      required: true
      schema:
        type: string
      description: |
        Un code region peut-être :
          * Le code INSEE d'une région
        
            Valeurs possibles :
            ```
            84 Auvergne-Rhône-Alpes
            27 Bourgogne-Franche-Comté
            53 Bretagne
            24 Centre-Val de Loire
            00 Collectivités d'outre-mer
            94 Corse
            44 Grand Est
            01 Guadeloupe
            03 Guyane
            32 Hauts-de-France
            04 La Réunion
            02 Martinique
            06 Mayotte
            28 Normandie
            75 Nouvelle-Aquitaine
            76 Occitanie
            52 Pays de la Loire
            93 Provence-Alpes-Côte d'Azur
            11 Île-de-France
            ```
          * Un code postal : dans ce cas la, l'API remontera elle même au code région.
    code_certification:
      name: code_certification
      description: | 
       Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
      in: path
      required: true
      schema:
        type: string
      examples:
        scolaire:
          value: "MEFSTAT11:32221031409"
        scolaire - seconde commune:
          value: "MEFSTAT11:23810031211"
        apprentissage:
          value: "CFD:32031409"

    code_certification_with_sise:
      name: code_certification
      description: | 
       Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
          * un code SISE pour le supérieur, précédé de "SISE:"<br />
          Exemple: "SISE:1234567"
      in: path
      required: true
      schema:
        type: string
      examples:
        scolaire:
          value: "MEFSTAT11:32221031409"
        scolaire - seconde commune:
          value: "MEFSTAT11:23810030003"
        apprentissage:
          value: "CFD:32031409"
        superieur:
          value: "SISE:2400019"

    codes_certifications:
      name: codes_certifications
      description: | 
        Un ou plusieurs codes de certification séparés par des virgules ou des |.
        <br /><br/>
        /!\ On ne peut pas mélanger le codes SISE et CFD/MEFSTAT11. Il n'est également pas possible de mettre plusieurs codes SISE.
        <br /><br/>
        Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
          * un code SISE pour le supérieur, précédé de "SISE:"<br />
          Exemple: "SISE:1234567"
      in: path
      required: true
      schema:
        type: string
      examples:
        scolaire:
          value: "MEFSTAT11:32221031409"
        scolaire - seconde commune:
          value: "MEFSTAT11:23810031211"
        apprentissage:
          value: "CFD:32031409"


    codes_certifications_with_sise:
      name: codes_certifications
      description: | 
        Un ou plusieurs codes de certification séparés par des virgules ou des |.

        Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
          * un code SISE pour le supérieur, précédé de "SISE:"<br />
          Exemple: "SISE:1234567"
      in: path
      required: true
      schema:
        type: string
        example: "SISE:32221031409"

    multiple_codes_certifications:
      name: codes_certifications
      required: true
      in: path
      description: |
        Plusieurs codes de certification séparés par des virgules ou des |.

        Un code certification peut-être :
          * un code formation diplome (CFD) pour la voie apprentissage, précédé de "CFD:"<br />
          Exemple: "CFD:12345678"
          * un code MEFSTAT11 pour la voie scolaire, précédé de "MEFSTAT11:"<br />
          Exemple: "MEFSTAT11:12345678910"
      schema:
        type: string
        example: "MEFSTAT11:32221031409|MEFSTAT11:32221033001|MEFSTAT11:23110022133|CFD:01033410|CFD:44633521"

    ext:
      name: ext
      in: path
      required: true
      schema:
        type: string
        enum: [ "json", "csv" ]
        default: json

  schemas:
    Error:
      type: object
      properties:
        statusCode:
          type: integer
        error:
          type: string
        message:
          type: string
        data:
          description: "Optionnel"
          type: object
          properties:
            millesimes:
              type: string
              description: "Millésime demandé (ou dernier millésime)"
            millesimesDisponible:
              type: array
              description: "Millésimes avec des données"
              items:
                type: string
    Pagination:
      type: object
      properties:
        page:
          type: string
        resultats_par_page:
          type: number
        nombre_de_page:
          type: number
        total:
          type: number
      description: Statut de la pagination
    Region:
      type: object
      required:
        - code
        - nom
      properties:
        code:
          type: string
          description: Le code INSEE de la région
        nom:
          type: string
          description: Le nom de la région
    Meta:
      type: object
      required:
        - date_import
      properties:
        date_import:
          type: string
        title:
          type: string
        description:
          type: string
        messages:
          description: Informations supplémentaires sur les données
          type: array
          items:
            type: string
          example: ["Les taux ne peuvent pas être affichés car il n'y a pas assez d'élèves pour fournir une information fiable."]
    DonneeSource:
      type: object
      required:
        - code
        - nom
      properties:
        code_certification:
          type: string
          description: Le code de la certification d'ou proviennent les données (Similaire dans le cas type = self)
        type:
          type: string
          description: |
            Le type de la source des données :
              * self : les données proviennent de la certification
              * ancienne : les données proviennent d'une certification plus ancienne
              * nouvelle : les données proviennent d'une certification plus récente

    FamilleMetier:
      type: object
      required:
        - code
        - libelle
        - isAnneeCommune
      description:
        Présent si la certification fait partie d'une famille de métier.
      properties:
        code:
          type: string
          description: |
            Le code de la famille de métiers défini sur la BCN.
            Les codes au format "XXX_temp" ne sont pas présent sur la BCN, leur code est temporaire.
        libelle:
          type: string
          description: Nom de la famille de métier
        isAnneeCommune:
          type: boolean
          description: |
            Indique si la certification correspond à l'année commune (Ex: seconde commune pour un bac PRO)

    CertificationsTerminales:
      description: |
        Présent si le code de certification ne correspond pas à une dernière année.

        Le tableau contient :
          - Pour une seconde commune : l'ensemble des code de certifications des dernières années de spécialités ayant des statistiques.
          - Pour le reste : un tableau n'ayant que le code de certification de la dernière année.
      type: array
      items:
        type: object
        required:
          - code_certification
        properties:
          code_certification:
            type: string
            description: |
              Code de certification d'une dernière année.
    Certification:
      type: object
      description: |
        Statistiques pour une certification.
        <br /><br />
        Les taux retournés sont :
          * null quand les effectifs (nb_annee_term) sont < 20
          * absent si l'on ne peut pas les calculer (données manquantes)

        Le champ "familleMetier" est présent lorsque la certification fait partie d'une famille de métier.
        <br /><br />
        Le champ "certificationsTerminales" est présent lorsque que le code de certification ne correspond pas à une dernière années :
          - Il contient les codes de certifications de dernière année possédant des statistique.
          - /!\ Lorsqu'il est présent, aucune statistique n'est envoyé, pour les récupérer il est nécessaire d'interroger
          l'API avec les codes de dernières année
      required:
        - millesime
        - code_certification
        - filiere
        - libelle
        - _meta
      properties:
        millesime:
          type: string
        code_certification:
          type: string
        filiere:
          type: string
          enum: [ "apprentissage", "pro", "agricole", "superieur" ]
        libelle:
          description: "Libellé de la certification"
          type: string
        libelle_ancien:
          description: "Ancien libellé de la certification (disponible en cas de changement de nom)"
          type: string
        date_fermeture:
          description: "Date de fermeture de la formation (si elle existe)"
          type: string
        formation_fermee:
          description: "Booléen qui permet de savoir si la certification est fermée"
          type: boolean
        donnee_source:
          $ref: "#/components/schemas/DonneeSource"
        familleMetier:
          $ref: "#/components/schemas/FamilleMetier"
        certificationsTerminales:
          $ref: "#/components/schemas/CertificationsTerminales"
        diplome:
          type: object
          properties:
            code:
              type: string
            libelle:
              type: string
        nb_sortant:
          type: number
        nb_annee_term:
          type: number
        nb_poursuite_etudes:
          type: number
        nb_en_emploi_24_mois:
          type: number
        nb_en_emploi_18_mois:
          type: number
        nb_en_emploi_12_mois:
          type: number
        nb_en_emploi_6_mois:
          type: number
        taux_en_emploi_24_mois:
          type: number
          nullable: true
        taux_en_emploi_18_mois:
          type: number
          nullable: true
        taux_en_emploi_12_mois:
          type: number
          nullable: true
        taux_en_emploi_6_mois:
          type: number
          nullable: true
        taux_en_formation:
          type: number
          nullable: true
        taux_autres_6_mois:
          type: number
          nullable: true
        taux_autres_12_mois:
          type: number
          nullable: true
        taux_autres_18_mois:
          type: number
          nullable: true
        taux_autres_24_mois:
          type: number
          nullable: true
        salaire_12_mois_q1:
          type: number
          nullable: true
          description: "en euros, 1er quartile du salaire net mensuel à 12 mois des sortants en emploi retrouvés dans la Base Tous Salariés (BTS)"
        salaire_12_mois_q2:
          type: number
          description: "en euros, 2ème quartile du salaire net mensuel à 12 mois des sortants en emploi retrouvés dans la Base Tous Salariés (BTS)"
          nullable: true
        salaire_12_mois_q3:
          type: number
          nullable: true
          description: "en euros, 3ème quartile du salaire net mensuel à 12 mois des sortants en emploi retrouvés dans la Base Tous Salariés (BTS)"
        _meta:
          $ref: "#/components/schemas/Meta"

    Regionale:
      type: object
      description: |
        Statistiques d'une certification pour une région.
        <br /><br /> 
        Les taux retournés sont :
          * null quand les effectifs (nb_annee_term) sont < 20
          * absent si l'on ne peut pas les calculer (données manquantes)

        Le champ "familleMetier" est présent lorsque la certification fait partie d'une famille de métier.
        <br /><br />
        Le champ "certificationsTerminales" est présent lorsque que le code de certification ne correspond pas à une dernière années :
          - Il contient les codes de certifications de dernière année possédant des statistique.
          - /!\ Lorsqu'il est présent, aucune statistique n'est envoyé, pour les récupérer il est nécessaire d'interroger
          l'API avec les codes de dernières année
      required:
        - millesime
        - code_certification
        - filiere
        - libelle
        - region
        - _meta
      properties:
        millesime:
          type: string
        code_certification:
          type: string
        filiere:
          type: string
          enum: [ "apprentissage", "pro", "agricole", "superieur" ]
        libelle:
          description: "Libellé de la certification"
          type: string
        libelle_ancien:
          description: "Ancien libellé de la certification (disponible en cas de changement de nom)"
          type: string
        date_fermeture:
          description: "Date de fermeture de la formation (si elle existe)"
          type: string
        formation_fermee:
          description: "Booléen qui permet de savoir si la certification est fermée"
          type: boolean
        donnee_source:
          $ref: "#/components/schemas/DonneeSource"
        nb_sortant:
          type: number
        nb_annee_term:
          type: number
        nb_poursuite_etudes:
          type: number
        nb_en_emploi_24_mois:
          type: number
        nb_en_emploi_18_mois:
          type: number
        nb_en_emploi_12_mois:
          type: number
        nb_en_emploi_6_mois:
          type: number
        taux_en_emploi_24_mois:
          type: number
          nullable: true
        taux_en_emploi_18_mois:
          type: number
          nullable: true
        taux_en_emploi_12_mois:
          type: number
          nullable: true
        taux_en_emploi_6_mois:
          type: number
          nullable: true
        taux_en_formation:
          type: number
          nullable: true
        taux_autres_6_mois:
          type: number
          nullable: true
        taux_autres_12_mois:
          type: number
          nullable: true
        taux_autres_18_mois:
          type: number
          nullable: true
        taux_autres_24_mois:
          type: number
          nullable: true
        region:
          $ref: "#/components/schemas/Region"
        _meta:
          $ref: "#/components/schemas/Meta"

    Formation:
      type: object
      description: |
        Statistiques d'une certification pour une formation.
        <br /><br />
        Les taux retournés sont :
          * null quand les effectifs (nb_annee_term) sont < 20
          * absent si l'on ne peut pas les calculer (données manquantes)
        <br /><br />
        Le champ "familleMetier" est présent lorsque la certification fait partie d'une famille de métier.
        <br /><br />
        Le champ "certificationsTerminales" est présent lorsque que le code de certification ne correspond pas à une dernière années :
          - Il contient les codes de certifications de dernière année possédant des statistique.
          - /!\ Lorsqu'il est présent, aucune statistique n'est envoyé, pour les récupérer il est nécessaire d'interroger
          l'API avec les codes de dernières année
      required:
        - uai
        - millesime
        - code_certification
        - filiere
        - libelle
        - region
        - _meta
      properties:
        uai:
          type: string
        libelle_etablissement:
          description: Nom de l'établissement
          type: string
        millesime:
          type: string
        code_certification:
          type: string
        filiere:
          type: string
          enum: [ "apprentissage", "pro", "agricole", "superieur" ]
        libelle:
          description: "Libellé de la certification"
          type: string
        libelle_ancien:
          description: "Ancien libellé de la certification (disponible en cas de changement de nom)"
          type: string
        date_fermeture:
          description: "Date de fermeture de la formation (si elle existe)"
          type: string
        formation_fermee:
          description: "Booléen qui permet de savoir si la certification est fermée"
          type: boolean
        donnee_source:
          $ref: "#/components/schemas/DonneeSource"
        nb_sortant:
          type: number
        nb_annee_term:
          type: number
        nb_poursuite_etudes:
          type: number
        nb_en_emploi_24_mois:
          type: number
        nb_en_emploi_18_mois:
          type: number
        nb_en_emploi_12_mois:
          type: number
        nb_en_emploi_6_mois:
          type: number
        taux_en_emploi_24_mois:
          type: number
          nullable: true
        taux_en_emploi_18_mois:
          type: number
          nullable: true
        taux_en_emploi_12_mois:
          type: number
          nullable: true
        taux_en_emploi_6_mois:
          type: number
          nullable: true
        taux_en_formation:
          type: number
          nullable: true
        taux_autres_6_mois:
          type: number
          nullable: true
        taux_autres_12_mois:
          type: number
          nullable: true
        taux_autres_18_mois:
          type: number
          nullable: true
        taux_autres_24_mois:
          type: number
          nullable: true
        region:
          $ref: "#/components/schemas/Region"
        uai_type:
          type: string
          description: Typologie de l'UAI (lieu de formation, formateur, gestionnaire ou inconnu)
          enum: [ "lieu_formation", "formateur", "gestionnaire", "inconnu" ]
        uai_donnee:
          type: string
          description: UAI de provenance de la donnée
        uai_donnee_type:
          type: string
          description: Typologie de l'UAI (lieu de formation, formateur, gestionnaire ou inconnu)
          enum: [ "lieu_formation", "formateur", "gestionnaire", "inconnu" ]
        uai_lieu_formation:
          type: array
          description: Tableau des UAIs des lieux de formations associés à la formation dans le cas ou le type de l'UAI est formateur ou gestionnaire
          items:
            type: string
        uai_formateur:
          type: array
          description: Tableau des UAIs formateurs associés à la formation dans le cas ou le type de l'UAI est lieu de formation ou gestionnaire
          items:
            type: string
        uai_gestionnaire:
          type: array
          description: Tableau des UAIs gestionnaires associés à la formation dans le cas ou le type de l'UAI est lieu de formation ou formateur
          items:
            type: string
        _meta:
          $ref: "#/components/schemas/Meta"

    CertificationFiliere:
      type: object
      description: |
        Statistiques pour une/plusieurs certifications en vue filière.

        Les taux retournés sont :
          * null quand les effectifs (nb_annee_term) sont < 20
          * absent si l'on ne peut pas les calculer (données manquantes)
      required:
        - millesime
        - filiere
        - _meta
      properties:
        millesime:
          type: string
        codes_certifications:
          type: array
          description: "Codes de certifications"
          items:
            type: string
        codes_formation_diplome:
          type: array
          description: "Tableau des CFD des certifications"
          items:
            type: string
        code_formation_diplome:
          type: string
          description: "CFD (lorsqu'un seul CFD est retourné)"
        libelle:
          description: "Libellé de la certification(lorsqu'un seul CFD est retourné)"
          type: string
        libelle_ancien:
          description: "Ancien libellé de la certification (lorsqu'un seul CFD est retourné, disponible en cas de changement de nom)"
          type: string
        filiere:
          type: string
          enum: [ "apprentissage", "pro", "agricole", "superieur" ]
        diplome:
          type: object
          description: Renvoi le diplome uniquement si le diplome de toutes les certifications est le même
          properties:
            code:
              type: string
            libelle:
              type: string
        date_fermeture:
          description: "Date de fermeture de la formation (si elle existe). Présent uniquement si il n'y a qu'un seul CFD."
          type: string
        formation_fermee:
          description: "Booléen qui permet de savoir si la certification est fermée.  Présent uniquement si il n'y a qu'un seul CFD."
          type: boolean
        nb_sortant:
          type: number
        nb_annee_term:
          type: number
        nb_poursuite_etudes:
          type: number
        nb_en_emploi_24_mois:
          type: number
        nb_en_emploi_18_mois:
          type: number
        nb_en_emploi_12_mois:
          type: number
        nb_en_emploi_6_mois:
          type: number
        taux_en_emploi_24_mois:
          type: number
          nullable: true
        taux_en_emploi_18_mois:
          type: number
          nullable: true
        taux_en_emploi_12_mois:
          type: number
          nullable: true
        taux_en_emploi_6_mois:
          type: number
          nullable: true
        taux_en_formation:
          type: number
          nullable: true
        taux_autres_6_mois:
          type: number
          nullable: true
        taux_autres_12_mois:
          type: number
          nullable: true
        taux_autres_18_mois:
          type: number
          nullable: true
        taux_autres_24_mois:
          type: number
          nullable: true
        _meta:
          $ref: "#/components/schemas/Meta"
    Login:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string
          format: password

  responses:
    '400':
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    '401':
      description: L'api key est manquante ou invalide
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    '404':
      description: Not Found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    "404-Code-Certification":
      description: Not Found
      content:
        application/json:
          examples:
            Certification inconnue:
              value: |
                {
                  "statusCode": 404,
                  "error": "Not Found",
                  "message": "Certification inconnue"
                }
            Pas de donnée pour le millésime:
             $ref: "#/components/examples/MillesimeNotFoundExample"
          schema:
            $ref: "#/components/schemas/Error"
    "404-Code-Regionale":
      description: Not Found
      content:
        application/json:
          examples:
            Certification inconnue:
              value: |
                {
                  "statusCode": 404,
                  "error": "Not Found",
                  "message": "Pas de données disponibles"
                }
            Pas de donnée pour le millésime:
             $ref: "#/components/examples/MillesimeNotFoundExample"
          schema:
            $ref: "#/components/schemas/Error"
    "404-Code-Formation":
      description: Not Found
      content:
        application/json:
          examples:
            Certification inconnue:
              value: |
                {
                  "statusCode": 404,
                  "error": "Not Found",
                  "message": "Formation inconnue"
                }
            Pas de donnée pour le millésime:
             $ref: "#/components/examples/MillesimeNotFoundExample"
          schema:
            $ref: "#/components/schemas/Error"
    
    CertificationsResponse:
      description: La liste des certifications avec leurs statistiques
      content:
        "application/json":
          schema:
            type: object
            properties:
              certifications:
                type: array
                items:
                  $ref: "#/components/schemas/Certification"
              pagination:
                $ref: "#/components/schemas/Pagination"
        "text/csv; charset=UTF-8":
          schema:
            type: string
            example: |
              code_certification;code_formation_diplome;filiere;millesime;donnee_source_type;donnee_source_code_certification;nb_annee_term;nb_en_emploi_12_mois;nb_en_emploi_18_mois;nb_en_emploi_24_mois;nb_en_emploi_6_mois;nb_poursuite_etudes;nb_sortant;taux_autres_12_mois;taux_autres_18_mois;taux_autres_24_mois;taux_autres_6_mois;taux_en_emploi_12_mois;taux_en_emploi_18_mois;taux_en_emploi_24_mois;taux_en_emploi_6_mois;taux_en_formation;taux_rupture_contrats
              50034303;50034303;apprentissage;2019;self;50034303;9;3;3;3;4;0;9;67;67;67;56;33;33;33;44;0;20

    CertificationResponse:
      description: Une certification avec ses statistiques
      content:
        "*/*":
          schema:
            $ref: "#/components/schemas/Certification"

    RegionalesResponse:
      description: La liste des statistiques de certifications pour toutes les régions
      content:
        "application/json":
          schema:
            type: object
            properties:
              regionales:
                type: array
                items:
                  $ref: "#/components/schemas/Regionale"
              pagination:
                $ref: "#/components/schemas/Pagination"
        "text/csv; charset=UTF-8":
          schema:
            type: string
            example: |
              region;code_certification;code_formation_diplome;filiere;millesime;donnee_source_type;donnee_source_code_certification;nb_annee_term;nb_en_emploi_12_mois;nb_en_emploi_18_mois;nb_en_emploi_24_mois;nb_en_emploi_6_mois;nb_poursuite_etudes;nb_sortant;taux_autres_12_mois;taux_autres_18_mois;taux_autres_24_mois;taux_autres_6_mois;taux_en_emploi_12_mois;taux_en_emploi_18_mois;taux_en_emploi_24_mois;taux_en_emploi_6_mois;taux_en_formation;taux_rupture_contrats
              Auvergne-Rhône-Alpes;01022103;01022103;apprentissage;2018_2019;self;01022103;106;55;48;55;46;38;67;12;19;12;21;52;45;52;43;36;


    RegionaleResponse:
      description: La liste des statistiques de certifications pour une région
      content:
        "*/*":
          schema:
            $ref: "#/components/schemas/Regionale"

    FormationsResponse:
      description: La liste des statistiques des formations
      content:
        "application/json":
          schema:
            type: object
            properties:
              formations:
                type: array
                items:
                  $ref: "#/components/schemas/Formation"
              pagination:
                $ref: "#/components/schemas/Pagination"
        "text/csv; charset=UTF-8":
          schema:
            type: string
            example: |
              uai;uai_type;uai_donnee;uai_donnee_type;code_certification;code_formation_diplome;filiere;millesime;donnee_source_type;donnee_source_code_certification;nb_annee_term;nb_en_emploi_12_mois;nb_en_emploi_18_mois;nb_en_emploi_24_mois;nb_en_emploi_6_mois;nb_poursuite_etudes;nb_sortant;taux_autres_12_mois;taux_autres_18_mois;taux_autres_24_mois;taux_autres_6_mois;taux_en_emploi_12_mois;taux_en_emploi_18_mois;taux_en_emploi_24_mois;taux_en_emploi_6_mois;taux_en_formation;taux_rupture_contrats
              0010826T;lieu_formation;self;0010826T;01022103;01022103;apprentissage;2019_2020;self;01022103;9;5;;;4;4;5;0;;;11;56;;;44;44;

    FormationResponse:
      description: Les statistiques d'une formation
      content:
        "*/*":
          schema:
            $ref: "#/components/schemas/Formation"

    FilieresResponse:
      description: |
        Statistiques agrégées par filière pour une ou plusieurs certifications
      content:
        "*/*":
          schema:
            type: object
            properties:
              pro:
                $ref: "#/components/schemas/CertificationFiliere"
              apprentissage:
                $ref: "#/components/schemas/CertificationFiliere"

    FilieresRegionaleResponse:
      description: |
        Statistiques agrégées par filière pour une ou plusieurs certifications
      content:
        "*/*":
          schema:
            type: object
            properties:
              pro:
                allOf:
                  - $ref: "#/components/schemas/CertificationFiliere"
                  - type: object
                    properties:
                      region:
                        $ref: "#/components/schemas/Region"
              apprentissage:
                allOf:
                  - $ref: "#/components/schemas/CertificationFiliere"
                  - type: object
                    properties:
                      region:
                        $ref: "#/components/schemas/Region"

    SVGResponse:
      description: Une image SVG
      content:
        "image/svg+xml":
          schema:
            type: string
            format: xml

    LoginResponse:
      description: Un json content un Token
      content:
        "application/json":
          schema:
            type: object
            properties:
              token:
                type: string

  examples:
    MillesimeNotFoundExample:
      value: |
              {
                "statusCode": 404,
                "error": "Not Found",
                "message": "Pas de données pour le millésime",
                "data": {
                  "millesime": "2022",
                  "millesimesDisponible": [
                    "2021",
                    "2020"
                  ]
                }
              }
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: query
      name: apiKey
    BearerAuth:
      type: http
      scheme: bearer

  