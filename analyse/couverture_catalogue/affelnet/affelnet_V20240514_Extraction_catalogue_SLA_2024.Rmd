---
title: "Base InserJeunes"
subtitle: "Formations couvertes par la base InserJeunes"
output: 
    html_document:
      toc: true
      toc_float:
        toc_collapsed: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,error = FALSE,message = FALSE)

source("../prepa_data_init.R")

```

## Affelnet

**Catalogue Affelnet 2024 V20240570_Extraction_catalogue_SLA_2024**: [Lien vers le catalogue](https://docs.google.com/spreadsheets/d/1X3WJAe3yy-fK5u8TvUVnbNOq67mye0D6/edit?usp=drive_link&ouid=107607241761816962784&rtpof=true&sd=true)

*Dernière mise à jour : `r format(Sys.time(), '%d/%m/%Y')`* 


### Nombre de formations


```{r}
Affelnet_20240570_Extraction_catalogue_SLA_2024  <- read_excel(file.path(chemin_racine_data,"affelnet/2024/20240570 - Catalogue SLA 2024 OF de voie professionnelle.xlsx"),
                                                               skip = 2)

affelnet_simpli <- Affelnet_20240570_Extraction_catalogue_SLA_2024 %>% 
  select(Etablissement,MEFSTAT11,Statut) %>% 
  setNames(c("UAI","MEFSTAT11","Filiere")) %>% 
  mutate(Filiere=ifelse(Filiere=="AP","Apprentissage","Scolaire"))

catalogue_affelnet_SLA_2024_renseigne <- expo_mef_catalogue_partenaire(catalogue_init = affelnet_simpli,type_source = "affelnet")
stats_catalogue_affelnet_SLA_2024 <- expo_mef_stats_catalogue_partenaire(catalogue_partenaire_renseigne = catalogue_affelnet_SLA_2024_renseigne)

# stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire %>%
#   mutate_all(replace_na,0) %>% 
#   mutate_at(vars(4:length(.)),as.numeric) %>% 
#     mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
#   DT::datatable(options = list(dom = 't',pageLength = 10000),rownames = F)
  # kableExtra::kbl(format.args = list(big.mark = " ", decimal.mark = ",")) %>%
  # kableExtra::kable_paper()

dt_header <- stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire %>%
  mutate_all(replace_na,0) %>% 
  mutate_at(vars(4:length(.)),as.numeric) %>% 
  mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
  slice(-nrow(.))


dt_footer <- stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire %>%
  mutate_all(replace_na,0) %>% 
  mutate_at(vars(4:length(.)),as.numeric) %>% 
  mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
  slice(nrow(.)) %>% 
  mutate_if("is.numeric",round,0) %>% 
  mutate_if("is.numeric",as.character)



sketch <- htmltools::withTags(table(
  tableHeader(dt_header),
  tableFooter(map_chr(dt_footer,~.))))


datatable(dt_header,
          extensions = c('FixedColumns','FixedHeader','Buttons'),
          container = sketch, 
          options = list(dom = 'Bt', pageLength = 10000,scrollX = TRUE,
                         fixedColumns = list(leftColumns = 3),fixedHeader = TRUE,
                             buttons = c('copy', 'csv', 'excel')
                         ),rownames = F)

```

<!--
### Nombre d'élèves en année terminale

```{r}
stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire_effectifs_temp %>%
  select(-`Nombre d'élèves à la rentrée`) %>% 
  mutate_all(replace_na,0) %>% 
  mutate_at(vars(4:length(.)),as.numeric) %>% 
    mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
  DT::datatable(options = list(dom = 't',pageLength = 10000),rownames = F)

```

-->

### Nombre de voeux émis

```{r}
# stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire_voeux %>%
#   mutate_all(replace_na,0) %>% 
#   mutate_at(vars(4:length(.)),as.numeric) %>% 
#     mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
#   DT::datatable(options = list(dom = 't',pageLength = 10000),rownames = F)

dt_header <- stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire_voeux %>%
  mutate_all(replace_na,0) %>% 
  mutate_at(vars(4:length(.)),as.numeric) %>% 
  mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
  slice(-nrow(.))


dt_footer <- stats_catalogue_affelnet_SLA_2024$stats_catalogue_partenaire_voeux %>%
  mutate_all(replace_na,0) %>% 
  mutate_at(vars(4:length(.)),as.numeric) %>% 
  mutate_at(vars(`Part du  catalogue`,contains("(%)")),scales::percent,accuracy=0.1) %>% 
  slice(nrow(.)) %>% 
  mutate_if("is.numeric",round,0) %>% 
  mutate_if("is.numeric",as.character)



sketch <- htmltools::withTags(table(
  tableHeader(dt_header),
  tableFooter(map_chr(dt_footer,~.))))


datatable(dt_header,
          extensions = c('FixedColumns','FixedHeader','Buttons'),
          container = sketch, 
          options = list(dom = 'Bt', pageLength = 10000,scrollX = TRUE,
                         fixedColumns = list(leftColumns = 3),fixedHeader = TRUE,
                             buttons = c('copy', 'csv', 'excel')
                         ),rownames = F)

```


